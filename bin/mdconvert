#!/bin/bash

# Markdown 多格式转换 CLI 工具
# 默认使用交互式界面,也支持命令行参数

# 获取脚本真实路径
get_install_dir() {
    local source="${BASH_SOURCE[0]}"
    while [ -h "$source" ]; do
        local dir="$(cd -P "$(dirname "$source")" && pwd)"
        source="$(readlink "$source")"
        [[ $source != /* ]] && source="$dir/$source"
    done
    local dir="$(cd -P "$(dirname "$source")" && pwd)"
    echo "$(dirname "$dir")"
}

INSTALL_DIR="$(get_install_dir)"
INTERACTIVE_SCRIPT="$INSTALL_DIR/scripts/convert_interactive.sh"
MULTI_SCRIPT="$INSTALL_DIR/scripts/convert_multi.sh"

# 检查是否有命令行参数 (除了输入文件)
has_options=false
for arg in "$@"; do
    if [[ "$arg" == -* ]]; then
        has_options=true
        break
    fi
done

# 如果有选项参数,使用非交互式脚本
if [ "$has_options" = true ]; then
    if [ ! -f "$MULTI_SCRIPT" ]; then
        echo "错误: 未找到转换脚本"
        exit 1
    fi
    exec "$MULTI_SCRIPT" "$@"
else
    # 否则使用交互式脚本
    if [ ! -f "$INTERACTIVE_SCRIPT" ]; then
        echo "错误: 未找到交互式脚本"
        exit 1
    fi
    exec "$INTERACTIVE_SCRIPT" "$@"
fi
