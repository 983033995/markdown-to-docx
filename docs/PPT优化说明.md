# PowerPoint 转换优化说明

## 优化目标

解决生成的 PPT 存在的以下问题：
1. ✅ 内容文字多时字体过大
2. ✅ 内容超出幻灯片界面
3. ✅ 段落结构排版不清晰

## 实现的优化

### 1. 幻灯片级别优化

**问题**: 内容堆积在少数幻灯片中，导致单页内容过多

**解决方案**:
- 设置 `--slide-level=2`，使用二级标题（`##`）创建新幻灯片
- 避免所有内容挤在一页

**效果**:
```markdown
# 第一部分          ← 章节分隔页

## 主题 1           ← 新幻灯片
内容...

## 主题 2           ← 新幻灯片
内容...
```

### 2. 字体大小控制

**问题**: 默认字体过大，占用空间多

**解决方案**:
- 设置 `-V fontsize=16pt`，统一使用 16pt 字体
- 代码块使用等宽字体 `Menlo`

**对比**:
- 优化前：20-24pt（过大）
- 优化后：16pt（适中）

### 3. 内容智能检测

**问题**: 列表、代码块、段落过长时无提示

**解决方案**: 添加 Lua 过滤器 `ppt-optimize.lua`

**检测规则**:
- 列表项 > 8 项 → 警告建议分割
- 代码块 > 15 行 → 自动截断并提示
- 段落 > 300 字符 → 警告建议分割

**示例输出**:
```
警告: 列表项过多 (12 项)，建议分割
警告: 代码块过长 (25 行)，已截断至 15 行
警告: 段落过长 (450 字符)，建议分割
```

### 4. 优化的模板

**问题**: 默认模板边距大，可用空间少

**解决方案**: 创建优化的 `reference.pptx` 模板

**优化内容**:
- 合理的边距设置
- 清晰的标题层级
- 适当的行距和段落间距

## 使用方式

### 自动应用（推荐）

所有优化已自动集成，直接使用即可：

```bash
# 交互式转换
mdconv document.md
# 选择 PPTX 格式

# 快速转换
mdconv -q -f pptx document.md
```

### 查看优化效果

转换时会显示优化信息：

```bash
处理 Mermaid 图表...
警告: 列表项过多 (10 项)，建议分割
警告: 代码块过长 (20 行)，已截断至 15 行
✓ 转换成功!
```

## 最佳实践

### 1. Markdown 文档结构

**推荐结构**:
```markdown
# 主标题（章节）

## 幻灯片标题 1
- 要点 1
- 要点 2
- 要点 3

## 幻灯片标题 2
简短的段落说明。

### 子要点
- 细节 1
- 细节 2
```

**避免**:
```markdown
# 主标题

大段大段的文字内容，没有分段，没有列表，
全部堆在一起，这样会导致单个幻灯片内容过多...

- 列表项 1
- 列表项 2
- 列表项 3
- 列表项 4
- 列表项 5
- 列表项 6
- 列表项 7
- 列表项 8
- 列表项 9
- 列表项 10  ← 过多
```

### 2. 内容密度控制

**每页建议内容量**:
- 标题：1 个
- 段落：1-2 段，每段 < 300 字符
- 列表：5-8 项
- 代码：< 15 行
- 图表：1 个

### 3. 代码块处理

**长代码建议**:
```markdown
## 代码示例

关键部分代码：

```python
# 只展示核心逻辑
def main():
    result = process_data()
    return result
```

完整代码请参考附录。
```

### 4. 列表分组

**过长列表分割**:
```markdown
## 功能特性（1/2）

- 特性 1
- 特性 2
- 特性 3
- 特性 4

## 功能特性（2/2）

- 特性 5
- 特性 6
- 特性 7
- 特性 8
```

## 进一步自定义

### 修改模板样式

1. 打开模板文件：
```bash
open templates/reference.pptx
```

2. 进入母版编辑：
   - 视图 → 幻灯片母版
   - 选择要修改的布局

3. 调整样式：
   - **标题字体**: 24-28pt，加粗
   - **正文字体**: 14-16pt
   - **行距**: 1.2-1.5 倍
   - **段落间距**: 6-12pt
   - **边距**: 上下左右各 1-1.5cm

4. 保存模板

### 调整过滤器参数

编辑 `filters/ppt-optimize.lua`：

```lua
-- 调整限制值
local max_items_per_slide = 8    -- 列表项上限
local max_code_lines = 15        -- 代码行数上限
local max_para_length = 300      -- 段落字符上限
```

## 技术细节

### 转换参数

```bash
pandoc input.md \
    -f markdown \
    -t pptx \
    --slide-level=2 \              # 二级标题创建新幻灯片
    -V fontsize=16pt \             # 字体大小
    -V monofont='Menlo' \          # 等宽字体
    --lua-filter=ppt-optimize.lua \ # 内容优化
    --reference-doc=reference.pptx \ # 样式模板
    -o output.pptx
```

### 文件清单

**新增文件**:
- `scripts/create_ppt_template.sh` - PPT 模板生成脚本
- `filters/ppt-optimize.lua` - PPT 内容优化过滤器
- `docs/PPT优化说明.md` - 本说明文档

**修改文件**:
- `scripts/convert_multi.sh` - 添加 PPT 优化参数
- `templates/reference.pptx` - 优化的 PPT 模板

## 常见问题

### Q1: 转换后字体还是太大？

**A**: 打开模板文件，调整母版中的字体大小：
```bash
open templates/reference.pptx
# 视图 → 幻灯片母版 → 调整字体
```

### Q2: 内容还是超出界面？

**A**: 检查 Markdown 结构，确保：
- 使用二级标题（`##`）分割内容
- 每页内容不超过建议量
- 查看转换时的警告信息

### Q3: 如何禁用内容检测？

**A**: 移除过滤器参数：
```bash
# 编辑 scripts/convert_multi.sh
# 注释掉这行：
# cmd="$cmd --lua-filter=\"$FILTER_DIR/ppt-optimize.lua\""
```

### Q4: 代码被截断了怎么办？

**A**: 
1. 将长代码分割为多个幻灯片
2. 或者调整 `ppt-optimize.lua` 中的 `max_code_lines` 值

## 总结

通过以上优化，PPT 转换质量显著提升：

✅ 字体大小合理（16pt）
✅ 内容自动分页（二级标题）
✅ 智能检测过长内容
✅ 优化的模板样式
✅ 清晰的警告提示

建议按照最佳实践编写 Markdown，可获得最佳转换效果！
